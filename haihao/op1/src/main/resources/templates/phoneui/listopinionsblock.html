<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<title>舆情中心-块级展示</title>
    
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=all" rel="stylesheet" type="text/css" />
<link href="${ctxPath}/static/assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
<link href="${ctxPath}/static/assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />

<link href="${ctxPath}/static/assets/phoneui/css/mui.min.css" rel="stylesheet"/>
<link rel="stylesheet" href="${ctxPath}/static/assets/phoneui/css/Global.css" />
<link rel="stylesheet" href="${ctxPath}/static/assets/phoneui/css/style.css">
<link rel="stylesheet" href="${ctxPath}/static/assets/phoneui/css/swiper.min.css">
<link rel="stylesheet" type="text/css" href="${ctxPath}/static/assets/phoneui/css/icons-extra.css" />
<link rel="stylesheet" href="${ctxPath}/static/assets/phoneui/css/style.css">


<script type="text/javascript" src="${ctxPath}/static/assets/phoneui/js/jquery-1.11.2.min.js"></script>
<script type="text/javascript" src="${ctxPath}/static/assets/phoneui/js/qiniuurl.js"></script>
<!-- 配置文件 -->
<script src="${ctxPath}/static/assets/layouts/layout2/scripts/demo.js" type="text/javascript"></script>


<script type="text/javascript" src="${ctxPath}/static/assets/phoneui/js/responsive.js" ></script>
<script src="${ctxPath}/static/assets/phoneui/js/swiper.min.js"></script>

<style>
body, html {
	min-width: 320px;
	max-width: 750px;
	height: 100%;
}
#hhh {
	width: 100%;
	
	background-size: 100% 100%;
}
#hhh .swiper-container {
	width: 100%;
	padding-top: 0.5rem;
}
#hhh .swiper-slide {
	background-position: center;
	background: #FFF;
	background-size: 130% 120%;
	width: 86%;
}
#hhh .swiper-slide img {
	display: block;
	width: 100%;
	max-height:240px;
}
#hhh .swiper-container h2 {
	text-align: center;
font-size:.7rem;
	font-weight: normal;
	padding: 1.2rem 0;
padding-bottom:.3rem
}
#hhh .swiper-button-next, .swiper-button-prev {
	top: 5rem;
	width: 10%;
	height: 7rem;
}

.news2 .pad {
padding:.5rem .8rem
}
.news2 .mui-btn-block {
	margin-bottom: 0;
	background: #06bebd;
	border: none
}
.mui-icon-settings{
-moz-transform:rotate(90deg);
-webkit-transform:rotate(90deg);}

.swiper-pagination{ position:fixed; bottom:1rem; color:#fff;} 
.mui-scroll{ height:calc(100% - 44px); background:#242a34}
</style>
</head>

<body class="news2 mbsc-fr-lock  ">

<input type="hidden" id="initData" value='${initData!}'>
<script type="text/javascript">
	var initData = {};
	if($("#initData").val())initData = jQuery.parseJSON($("#initData").val());
</script>



<div id="offCanvasWrapper" class="mui-off-canvas-wrap mui-draggable"> 
  <!--侧滑菜单部分-->
  <aside id="offCanvasSide" class="mui-off-canvas-left">
    <div id="offCanvasSideScroll" class="mui-scroll-wrapper">
      <div class="mui-scroll">
        <div class="title font-avenir departmentname" style="padding:30px 15px; color:#fff; font-size:1rem; letter-spacing:5px"></div>
       
        <ul class="mui-table-view mui-table-view-chevron mui-table-view-inverted" style="background: #242a34;">
	         <li class="mui-table-view-cell mui-collapse">
				<a class="gongkai" href="javascript:void(0)">公开舆情</a>
			</li>
			
			<li class="mui-table-view-cell mui-collapse">
				<a class="heshilist" href="javascript:void(0)" >舆情核实</a>
			</li>
			
			<li class="mui-table-view-cell mui-collapse">
				<a class="zhuanban" href="javascript:void(0)">舆情转办</a>
			</li>
			
			<li class="mui-table-view-cell mui-collapse">
				<a class="pishi" href="javascript:void(0)">舆情批示</a>
			</li>
			
			
	        <!-- <li class="mui-table-view-cell mui-collapse">
				<a class="" href="${ctxPath}/news/toaddnews">我要发布</a>
			</li> -->
			<li class="mui-table-view-cell mui-collapse">
				<a class="" href="${ctxPath}/phoneui/usercenter">返回个人中心</a>
			</li>
	        <li class="mui-table-view-cell mui-collapse">
				<a class="green" id="offCanvasHide"  href="#offCanvasSide">关闭</a>
				<span id="dianji" style="display: none;"></span>
				
			</li>
			
		
			
        </ul>
      </div>
    </div>
  </aside>
  <!--主界面部分-->
  <div class="mui-inner-wrap">
  
     
     <header class="mui-bar mui-bar-nav ">
		<a class="mui-icon mui-icon mui-icon-bars" href="#offCanvasSide"></a>
      	<h1 class="mui-title">舆情列表</h1>
      	<a class="mui-icon mui-icon-settings right" href="${ctxPath}/phoneui/listopinions"></a>
    </header>
    <div class="heihead"></div>
    
    
    <div id="offCanvasContentScroll">
      <div class="mui-scroll">
        
		<div class="mui-text-center riqi">&nbsp;</div>
		<div class="index"> 
	      <!-- 轮播 -->
	      <header id="hhh">
	      
	      <!-- 内容块 -->
	      
	        
	        
	        
	        
	  	</header>
	    </div>
	    
	    </div>
	 </div>
	</div>
</div>
	    
<script src="${ctxPath}/static/assets/phoneui/js/mui.min.js"></script> 
<script type="text/javascript">

mui.init({
	//swipeBack:true //启用右滑关闭功能
});


$(document).ready(function() {
	
	jQuery(".departmentname").html(listFormatter({id:"departments"},"${authenticationFn().userDto.departmentId}"));
	
	function InitOpenNewsList(domId,initDataId){
		$("#hhh").html("");
		var _items = initData[initDataId];
		
		var newcont="";
		for(var i = 0;i < _items.length;i++){
			var j = _items[i];
			
				var starsval = listFormatter({id:"lists"},j["levelId"]);
				var stars ='<span class="mui-icon mui-icon-star"></span>';
				if(starsval=="0"){
					stars='<span class="mui-icon mui-icon-star"></span><span class="mui-icon mui-icon-star"></span><span class="mui-icon mui-icon-star"></span><span class="mui-icon mui-icon-star"></span><span class="mui-icon mui-icon-star"></span>';
				}
				
				if(starsval=="1星"){
					stars='<span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star"></span><span class="mui-icon mui-icon-star"></span><span class="mui-icon mui-icon-star"></span><span class="mui-icon mui-icon-star"></span>';
				}
				if(starsval=="2星"){
					stars='<span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star"></span><span class="mui-icon mui-icon-star"></span><span class="mui-icon mui-icon-star"></span>';
				}
				if(starsval=="3星"){
					stars='<span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star"></span><span class="mui-icon mui-icon-star"></span>';
				}
				if(starsval=="4星"){
					stars='<span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star"></span>';
				}
				if(starsval=="5星"){
					stars='<span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star-filled"></span>';
				}
				       
				newcont +=String.format('<div class="swiper-slide">'
							+'<h2>{0}</h2>'
 							+'<p class=" mui-text-center">{1}</p>'
 							+'<div class="star mui-text-center">'
 							+stars
 							+'</div>'
 							+'<P class="mui-clearfix hei"></P>'
 							+'<img src="{2}" alt="图片加载失败">'
 							+'<div class="pad grew">'
 							+'	<span class="mui-pull-left"> <i class="ico22"></i>{3}</span>' 
 							+'	<span class="mui-pull-right"> <i class="ico22"></i> {4}</span>'
 							+'</div>'
 							+'<p class="mui-clearfix hei"></p>'
 							+'<div class="mui-clearfix pad grew">'
 							+'	{5}</div>'
 							+'<P class="mui-clearfix hei"></P>'
 							+'<a href="${ctxPath}/phoneui/opinionsinfo?id={6}" class="mui-btn mui-btn-block mui-btn-green ">去看看</a>'
 							+'</div>',j["subject"],dateFormatter(j["createdDate"]),window.qiniuDomainHttp+j["mainImg"],listFormatter({id:"lists"},j["categoryId"]),getdisplaynamebyuid(j["createdBy"]),j["memo"],j["id"]);
	 			
	 			
		}
		
		
		var waicont ='<div class="swiper-container">'
		       	+'<div class="swiper-wrapper">'
				+newcont+'</div>'
				+' </div>'
		       +'<div class="swiper-pagination"></div>';
		       
					
		$(domId).append(waicont);
		
		var swiper = new Swiper('.swiper-container', {
			    pagination: '.swiper-pagination',  
			    effect: 'coverflow',  
			    grabCursor: true,  
			    centeredSlides: true,  
			    slidesPerView: 'auto',  
				paginationType: 'fraction',
			    coverflow: {  
			        rotate: 0,// 旋转的角度  
			        stretch: 100,// 拉伸   图片间左右的间距和密集度  
			        depth: 120,// 深度   切换图片间上下的间距和密集度  
			        modifier: 5,// 修正值 该值越大前面的效果越明显  
			        slideShadows : true// 页面阴影效果  
			    }  
			}); 
		
	}
	InitOpenNewsList("#hhh", "listopennews");
	
	mui('body').on('tap','.gongkai',function(){
		mui('#offCanvasWrapper').offCanvas('close');
		InitOpenNewsList("#hhh", "listopennews");
	});
	
	
	
	 function listFormatter(columnDef, value){
    	var _items = initData[columnDef.id];
    	 for(var i = 0;i < _items.length;i++){
    		 var j = _items[i];
  				 if(j["id"] == value){
  					 return j["label"];
  				 }
    	 }
    }
    
    function dateFormatter(value){
	  var d = new Date();
	  d.setTime(value);
	  return d.pattern("MM-dd HH:mm");
    }
    
    
    function getdisplaynamebyuid(value){//根据用户id检索出当前用户名
    	var name='';
		//异步获取
		$.ajax({
		url : 'ajaxgetusernamebyid',
		type : "post",
		data :{userid:value},
		dataType: "json",
		async: false,
		success : function(data) {
			name=data.data.displayName;
			
		}

		});
		return name;
    	
    }
    
   
    
    var _url;
    var datajson;
    var ispost = false;
    var swipernum;
    var opinionurl;
    var wordremark;
    //核实列表
    mui('body').on('tap','.heshilist',function(){
    	mui('#offCanvasWrapper').offCanvas('close');
    	datajson={"start":0,"limit":100,"page":{"rowStart":0,"limit":100},"filters":[{"property":"opinionModel.enabled","value":"1","operation":"="}],"sorts":[{"property":"opinionModel.id","order":"desc"}],"data":{"departmentId":"${authenticationFn().userDto.departmentId}"}};
    	_url = 'ajaxlistOpinionByVerify';
    	$("#dianji").trigger("click");
    	swipernum=1;
    	opinionurl="opinionsheshiinfo?id=";
    	wordremark="去核实";
    });
    
    //舆情转办
	mui('body').on('tap','.zhuanban',function(){
    	
    	mui('#offCanvasWrapper').offCanvas('close');
    	datajson={"start":0,"limit":100,"page":{"rowStart":0,"limit":100},"filters":[{"property":"opinionModel.enabled","value":"1","operation":"="}],"sorts":[{"property":"opinionModel.id","order":"desc"}],"data":{"departmentId":"${authenticationFn().userDto.departmentId}"}};
    	_url = 'ajaxlistOpinionByTodo';
    	$("#dianji").trigger("click");
    	swipernum=2;
    	opinionurl="opinionszhuanbaninfo?id=";
    	wordremark="去反馈";
    });
    

	//舆情批示
	mui('body').on('tap','.pishi',function(){
		mui('#offCanvasWrapper').offCanvas('close');
		datajson={"start":0,"limit":100,"page":{"rowStart":0,"limit":100},"filters":[{"property":"opinionModel.enabled","value":"1","operation":"="}],"sorts":[{"property":"opinionModel.id","order":"desc"}]};
		_url = 'ajaxlistOpinionByInstruction';
		$("#dianji").trigger("click");
		swipernum=3;
		opinionurl="opinionspishiinfo?id=";
		wordremark="去跟踪";
	});
	
	

	$("#dianji").click(function(){
		$.ajax({
			url : _url,
			type : "post",
			data :{data:JSON.stringify(datajson)},
			dataType: "json",
			success : function(data) {
				if (data.success) {//加载待核实舆情
					
					$("#hhh").html("");
					var newcont="";
					
					$.each(data.results,function(i,val){
						var starsval = listFormatter({id:"lists"},val.levelId);
						var stars ='<span class="mui-icon mui-icon-star"></span>';
						if(starsval=="0"){
							stars='<span class="mui-icon mui-icon-star"></span><span class="mui-icon mui-icon-star"></span><span class="mui-icon mui-icon-star"></span><span class="mui-icon mui-icon-star"></span><span class="mui-icon mui-icon-star"></span>';
						}
						
						if(starsval=="1星"){
							stars='<span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star"></span><span class="mui-icon mui-icon-star"></span><span class="mui-icon mui-icon-star"></span><span class="mui-icon mui-icon-star"></span>';
						}
						if(starsval=="2星"){
							stars='<span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star"></span><span class="mui-icon mui-icon-star"></span><span class="mui-icon mui-icon-star"></span>';
						}
						if(starsval=="3星"){
							stars='<span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star"></span><span class="mui-icon mui-icon-star"></span>';
						}
						if(starsval=="4星"){
							stars='<span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star"></span>';
						}
						if(starsval=="5星"){
							stars='<span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star-filled"></span><span class="mui-icon mui-icon-star-filled"></span>';
						}
						
						
						
						newcont += '<div class="swiper-slide">'
	 							+'<h2>'+val.subject+'</h2>'
	 							+'<p class=" mui-text-center">'+dateFormatter(val.createdDate)+'</p>'
	 							+'<div class="star mui-text-center">'
	 							+stars
	 							+'</div>'
	 							+'<P class="mui-clearfix hei"></P>'
	 							+'<img src="'+window.qiniuDomainHttp+val.mainImg+'" alt="图片加载失败">'
	 							+'<div class="pad grew">'
	 							+'	<span class="mui-pull-left"> <i class="ico22"></i>'+listFormatter({id:"lists"},val.categoryId)+'</span>'
	 							+'	<span class="mui-pull-right"> <i class="ico22"></i> '+val.createdBy+'</span>'
	 							+'</div>'
	 							+'<P class="mui-clearfix hei"></P>'
	 							+'<div class="mui-clearfix pad grew">'
	 							+val.memo+'</div>'
	 							+'<p class="mui-clearfix hei"></p>'
	 							+'<a href="${ctxPath}/phoneui/'+opinionurl+val.id+'" class="mui-btn mui-btn-block mui-btn-green ">'+wordremark+'</a>'
	 							+'</div>';
						
					})
					
					
				 	var waicont ='<div class="swiper-container dd'+swipernum+'">'
				       	+'<div class="swiper-wrapper">'
						+newcont+'</div>'
		   				+' </div>'
				       +'<div class="swiper-pagination cc'+swipernum+'"></div>';
				       
 							
				   	$("#hhh").append(waicont);
					
					
					
					var swipers = new Swiper('.dd'+swipernum, {
					    pagination: '.cc'+swipernum,  
					    effect: 'coverflow',  
					    grabCursor: true,  
					    centeredSlides: true,  
					    slidesPerView: 'auto',  
						paginationType: 'fraction',
					    coverflow: {  
					        rotate: 0,// 旋转的角度  
					        stretch: 100,// 拉伸   图片间左右的间距和密集度  
					        depth: 120,// 深度   切换图片间上下的间距和密集度  
					        modifier: 5,// 修正值 该值越大前面的效果越明显  
					        slideShadows : true// 页面阴影效果  
					    }  
					}); 
					
					
				} else {//提示暂无
					mui.alert("暂无相关舆情！", '提示', function() {
						location.reload();
					});
				}
			}
		});
	});
	
	
  
});




$(".mui-table-view-cell a").click(function(){
	if($(this).parent().find("ul").hasClass("on")){
		$(this).parent().find("ul").removeClass("on");
	}else{
		$(this).parent().find("ul").addClass("on"); 
	}
});


</script>
        
        


<script>
	//解决a标签失效的问题
	mui('body').on('tap','a',function(){document.location.href=this.href;});
	
	 //侧滑容器父节点
	var offCanvasWrapper = mui('#offCanvasWrapper');
	 
	 //主界面容器
	var offCanvasInner = offCanvasWrapper[0].querySelector('.mui-inner-wrap');
	 //菜单容器
	var offCanvasSide = document.getElementById("offCanvasSide");
	if (!mui.os.android) {
		document.getElementById("move-togger").classList.remove('mui-hidden');
		var spans = document.querySelectorAll('.android-only');
		for (var i = 0, len = spans.length; i < len; i++) {
			spans[i].style.display = "none";
		}
	}
	 //移动效果是否为整体移动
	var moveTogether = false;
	 //侧滑容器的class列表，增加.mui-slide-in即可实现菜单移动、主界面不动的效果；
	var classList = offCanvasWrapper[0].classList;
	 //变换侧滑动画移动效果；
	mui('.mui-input-group').on('change', 'input', function() {
		if (this.checked) {
			offCanvasSide.classList.remove('mui-transitioning');
			offCanvasSide.setAttribute('style', '');
			classList.remove('mui-slide-in');
			classList.remove('mui-scalable');
			switch (this.value) {
				case 'main-move':
					if (moveTogether) {
						//仅主内容滑动时，侧滑菜单在off-canvas-wrap内，和主界面并列
						offCanvasWrapper[0].insertBefore(offCanvasSide, offCanvasWrapper[0].firstElementChild);
					}
					break;
				case 'main-move-scalable':
					if (moveTogether) {
						//仅主内容滑动时，侧滑菜单在off-canvas-wrap内，和主界面并列
						offCanvasWrapper[0].insertBefore(offCanvasSide, offCanvasWrapper[0].firstElementChild);
					}
					classList.add('mui-scalable');
					break;
				case 'menu-move':
					classList.add('mui-slide-in');
					break;
				case 'all-move':
					moveTogether = true;
					//整体滑动时，侧滑菜单在inner-wrap内
					offCanvasInner.insertBefore(offCanvasSide, offCanvasInner.firstElementChild);
					break;
			}
			offCanvasWrapper.offCanvas().refresh();
		}
	});
	 //主界面‘显示侧滑菜单’按钮的点击事件
	document.getElementById('offCanvasShow').addEventListener('tap', function() {
		offCanvasWrapper.offCanvas('show');
	});
	 //菜单界面，‘关闭侧滑菜单’按钮的点击事件
	document.getElementById('offCanvasHide').addEventListener('tap', function() {
		offCanvasWrapper.offCanvas('close');
	});
	 //主界面和侧滑菜单界面均支持区域滚动；
	mui('#offCanvasSideScroll').scroll();
	mui('#offCanvasContentScroll').scroll();
	 //实现ios平台原生侧滑关闭页面；
	if (mui.os.plus && mui.os.ios) {
		mui.plusReady(function() { //5+ iOS暂时无法屏蔽popGesture时传递touch事件，故该demo直接屏蔽popGesture功能
			plus.webview.currentWebview().setStyle({
				'popGesture': 'none'
			});
		});
	}
	 
	 
	 
	 

	 
	 
</script>
       
</body>





</html>