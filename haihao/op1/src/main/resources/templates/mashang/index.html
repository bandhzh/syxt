<div class="row">
	<div class="col-md-12">
		<div class="portlet light portlet-fit portlet-datatable ">
			<div class="portlet-title">
				<div class="caption">
					<i class="icon-settings font-dark"></i> <span class="caption-subject font-dark sbold uppercase">信息管理</span>
				</div>
				<div class="actions">
					<div class="margin-bottom-5">
						<button class="btn btn-sm btn-success filter-submit margin-bottom">
							<i class="fa fa-search"></i> 查询
						</button>

						<button class="btn btn-sm btn-success add-submit  margin-bottom">
							<i class="fa fa-plus"></i> 新建
						</button>
						<button class="btn btn-sm btn-success remove-submit  margin-bottom">
							<i class="fa fa-remove"></i> 删除
						</button>
					</div>
				</div>

			</div>
			
			
				<div class="portlet-body">
					<div class="table-container">
						<table class="table table-striped table-bordered table-hover table-checkable" id="datatable_orders">
							<thead>
								<tr role="row" class="heading">
									<th width="20%">主题</th>
									<th width="15%">类别</th>
									<th width="15%">等级</th>
									<th width="20%">发布时间</th>
									<th width="10%">核实状态</th>
									<th width="10%">处理状态</th>
								</tr>
								<tr role="row" class="filter">
									<td><input type="text" class="form-control form-filter input-sm" columnName="maShangeModel.subject" operation="like"></td>
									<td><select id="categoryIds" class="form-control  form-filter selectpicker" columnName="maShangeModel.categoryId"></select></td>
									<td><select id="levelIds" class="form-control  form-filter selectpicker" columnName="maShangeModel.levelId"></select></td>
									<td>
										<div class="form-group" style="margin-bottom: 0px;">
											<div class="input-group input-large date-picker input-daterange" data-date="2012-11-10" data-date-format="yyyy-mm-dd">
												<input type="text" controlType="date" class="form-control form-filter" columnName="maShangeModel.publishDate" operation=">="> <span class="input-group-addon"> to </span> <input type="text" class="form-control form-filter" columnName="maShangeModel.publishDate" operation="<=" controlType="date">
											</div>
										</div>
									</td>
									<td><select class="form-control  form-filter selectpicker" columnName="maShangeModel.status">
											<option value="" selected="selected">请选择...</option>
											<option value="-1">待核实</option>
											<option value="1">核实中</option>
											<option value="2">已核实</option>
											<option value="3">已转办</option>
											<option value="10">归档</option>

									</select></td>
									<td><select class="form-control  form-filter selectpicker" columnName="maShangeModel.toDoStatus">
											<option value="" selected="selected">请选择...</option>
											<option value="4">待处理</option>
											<option value="5">处理中</option>
											<option value="6">处理完成</option>
											<option value="7">无法处理</option>
									</select></td>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td colspan="8">
										<div id="slickGrid" class="grid"></div>
										<div id="pager" class="om-grid om-widget om-widget-content" style="width: 100%; height: 30px;"></div>
									</td>
								</tr>

							</tbody>
						</table>
					</div>
				</div>

			
			
			</div>
			</div>
			</div>




			<!-- /.编辑信息 -->
			<div class="modal fade bs-modal-lg" id="large" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
				<div class="modal-dialog modal-lg">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
							<h4 class="modal-title">马上办信息</h4>
						</div>
						<div class="modal-body">
							<div class="portlet-body form">
								<form action="#" class="horizontal-form" id="validationForm">
									<input type="hidden" class="form-control columnName" columnName="maShangeModel.id">
									<div class="form-body">
										<h3 class="form-section batchHidden" style="margin-top: 0px;">基本信息</h3>
										<div class="row">
											<div class="col-md-6">
												<div class="form-group">
													<label>标题</label> <input type="text" name="subject" class="form-control columnName" columnName="maShangeModel.subject">
												</div>
											</div>

											<div class="col-md-6">
												<div class="form-group">
													<label>主图</label>
													<div class="input-group">
														<input type="hidden" class="form-control columnName" id="mainImg" controlType="image" showTo="#productImage_1"  columnName="maShangeModel.mainImg"> <a class="btn btn-default btn-lg " id="pickfiles" href="#"> <i class="glyphicon glyphicon-plus"></i> <span>选择文件</span>
														</a>
													</div>
												</div>
											</div>


											<div class="col-md-6">
												<div class="form-group">
													<img align="absmiddle" style="height: 100px;" id="productImage_1" src="${ctxPath}/static/assets/global/img/no_image.jpg" imagedefinionid="1">
												</div>
											</div>

											<div class="col-md-6">
												<div class="form-group">
													<label>类别</label> <select class="form-control selectpicker columnName" controlType="select" name="categoryId" id="categoryIds2" columnName="maShangeModel.categoryId">
													</select>
												</div>
											</div>

											<div class="col-md-6">
												<div class="form-group">
													<label>等级</label> <select class="form-control selectpicker columnName" controlType="select" name="levelId" id="levelIds2" columnName="maShangeModel.levelId">
													</select>
												</div>
											</div>

											<div class="col-md-6">
												<div class="form-group">
													<label>来源</label> <select class="form-control selectpicker columnName" controlType="select" name="sourceId" id="sourceIds2" columnName="maShangeModel.sourceId">
													</select>
												</div>
											</div>


											<div class="col-md-6">
												<div class="form-group">
													<label>备注</label> <input type="text" name="memo" class="form-control columnName" columnName="maShangeModel.memo">
												</div>
											</div>

											<div class="col-md-12">
												<div class="form-group">
													<script type="text/pain" id="deitor" name="ceshi"></script>
													<!-- <label>内容</label> <input type="text" name="content" class="form-control columnName" columnName="maShangeModel.content"> -->
												</div>
											</div>


										</div>

									</div>
								</form>
							</div>
						</div>


						<div class="modal-footer">
							<button type="button" class="btn dark btn-outline" data-dismiss="modal">关闭</button>
							<button type="button" class="btn green" id="saveForm">保存</button>
						</div>

					</div>
				</div>
			</div>


			<!-- /.发起核实-->
			<div class="modal fade bs-modal-sm" id="small" tabindex="1" role="dialog" aria-labelledby="mySmallModalLabel">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
							<h4 class="modal-title">信息</h4>
						</div>
						<div class="modal-body">
							<div id="slickGrid2" class="grid" style="overflow: hidden; width: 580px;"></div>
						</div>
					</div>
				</div>
			</div>


			<div class="modal fade bs-modal-sm" id="small2" tabindex="1" role="dialog" aria-labelledby="mySmallModalLabel">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
							<h4 class="modal-title">信息</h4>
						</div>
						<div class="modal-body">
							<input type="hidden" class="form-control columnName" id="opinionToDoModelOpinionId" columnName="opinionToDoModel.opinionId">
							<div class="row">
								<div class="col-md-6">
									<div class="form-group">
										<label>主办部门</label> <select class="form-control selectpicker " controlType="select" id="mainTodo">
										</select>
									</div>
								</div>

								<div class="col-md-6">
									<div class="form-group">
										<label>协办部门</label> <select class="form-control selectpicker columnName" controlType="select" id="subTodo" multiple>
										</select>
									</div>
								</div>
							</div>

						</div>

						<div class="modal-footer">
							<button type="button" class="btn dark btn-outline" data-dismiss="modal">关闭</button>
							<button type="button" class="btn green" id="saveForm2">保存</button>
						</div>

					</div>
				</div>
			</div>
			
			
				  
	  
	  
	  
	  
	  	<div class="modal fade bs-modal-sm" id="userSelect" tabindex="1" role="dialog" aria-labelledby="mySmallModalLabel">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
							<h4 class="modal-title">选择人员</h4>
						</div>
											<div class="modal-body">
						<div class="portlet-body form">
							<form action="#" class="horizontal-form" >
								<div class="form-body">
									<div class="row">
										<div class="col-md-6">
											<div class="form-group">
												<label>用户部门树</label>
												 <ul id="userDepartTree" class="ztree"></ul>
											</div>
										</div>

									</div>

								</div>
							</form>
						</div>
					</div>

						<div class="modal-footer">
							<button type="button" class="btn dark btn-outline" data-dismiss="modal">关闭</button>
							<button type="button" class="btn green" id="saveSelectUser">保存</button>
						</div>

					</div>
				</div>
			</div>

			<script>
				var myDataView, myGrid, pager, myDataView2, myGrid2, ue,userNodes = [],userTreeObj,_id;
				$(window).resize(function() {
					$("#slickGrid").width($("#slickGrid").parent().width());
					$("#slickGrid").height($(document).height() - 380);
					if (myGrid) {
						myGrid.resizeCanvas();
					}

				});
				
			    var setting2 = {
			  			check: {
			  				enable: true
			  			},
			  			data: {
			  				simpleData: {
			  					enable: true
			  				}
			  			}
			  		};
				
				$(document).ready(function() {
					$(window).resize();

					ue = UE.getEditor('deitor');
					
					 //上传
					  var uploader = Qiniu.uploader({
				        runtimes: 'html5,flash,html4',
				        browse_button: 'pickfiles',
				        max_file_size: '10mb',
				        flash_swf_url: '${ctxPath}/static/assets/global/plugins/plupload-2.1.8/js/Moxie.swf',
				        chunk_size: '4mb',
				        filters:[{title : "图片文件", extensions : "jpg,png,gif"}],
				        uptoken_url: "${ctxPath}/ajaxGetUploadToken",
				        domain: window.qiniuDomain,
				        get_new_uptoken: false,
				        auto_start: true,
				        log_level: 5,
				        init: {
				            'FilesAdded': function(up, files) {
				            },
				            'BeforeUpload': function(up, file) {
				            	App.blockUI({
				    		          boxed: true
				    		      });
				            },
				            'UploadProgress': function(up, file) {
				            },
				            'UploadComplete': function() {
				            	App.unblockUI();
				            },
				            'FileUploaded': function(up, file, info) {
				            	var _key = $.parseJSON(info).key;
				            	$("#mainImg").val(_key);
								$("#productImage_1").attr("src",window.qiniuDomainHttp + _key)	            	
				            },
				            'Error': function(up, err, errTip) {
				            	App.unblockUI();
				            },
				            Key:function(up, file) {
			                	return $.QiniuUUID().getKet(file);
			                }
				        }});

					selectInit("#mainTodo", "departments");
					selectInit("#subTodo", "departments");

					$(".remove-submit").bind("click", function() {
						var items = myGrid.getSelectedRows();
						var ids = [];
						for (var i = 0; i < items.length; i++) {
							ids.push(myDataView.getItemByIdx(items[i])["id"]);
						}
						var params = {
							data : {
								"ids" : ids.toString()
							}
						};
						var _data = {
							data : JSON.stringify(params)
						};
						if (ids.length > 0) {
							$.ajax({
								url : "${ctxPath}/mashange/remove",
								type : "post",
								data : _data,
								success : function(data) {
									if (data.success) {
										pager.reload();
									} else {
										pager.reload();
									}
								}
							});
						}
					});

					selectInitList("#categoryIds", "lists", 1);
					selectInitList("#categoryIds2", "lists", 1);
					selectInitList("#levelIds", "lists", 2);
					selectInitList("#levelIds2", "lists", 2);
					selectInitList("#sourceIds2", "lists", 3);
					
					
					for(var i = 0;i < initData["departments"].length;i++){
						  var j = initData["departments"][i];
						  userNodes.push({
							  id:"D" + j.id,
							  pId:"D" + j.pId,
							  name:j.label,
							  type:"D",
							  isParent:true
						  });
					}
					for(var i = 0;i < initData["users"].length;i++){
						var j = initData["users"][i];
						userNodes.push({
							  id:"U" + j.id,
							  pId:"D" + j.departmentId,
							  name:j.displayName,
							  type:"U",
							  isParent:false
						  });
					}
					userTreeObj = $.fn.zTree.init($("#userDepartTree"), setting2, userNodes);

					var validationForm = $("#validationForm");
					validationForm.validate({
						errorElement : 'span', //default input error message container
						errorClass : 'help-block help-block-error', // default input error message class
						rules : {
							subject : {
								rangelength : [ 2, 50 ],
								required : true
							},
							categoryId : {
								required : true
							},
							levelId : {
								required : true
							},
							needVerify : {
								required : true
							},
							sourceId : {
								required : true
							},
							isPublic : {
								required : true
							}
						}
					});

					$(".add-submit").bind("click", function() {
						$('#large').modal('show');
						formClear({
							filter : "#validationForm .columnName"
						})
					});

					$(".filter-submit").bind("click", function() {
						var filterParameters = [];
						filterParameters = filterParametersBuild({filter:".form-filter"});
						filterParameters.push({
							property : "maShangeModel.enabled",
							value : "1",
							operation : "="
						});
						pager.setSearch(filterParameters);
						pager.setSort([ {
							"property" : "maShangeModel.id",
							"order" : "desc"
						} ]);
						pager.reload();
					});

					myDataView = new Slick.Data.DataView({
						inlineFilters : true
					});
					myDataView.setItems([]);
					var options = {
						editable : false,
						enableAddRow : false,
						enableCellNavigation : true,
						enableColumnReorder : true,
						asyncEditorLoading : false,
						forceFitColumns : false,
						forceSyncScrolling : false,
						rowHeight : 30
					}

					var checkboxSelector = new Slick.CheckboxSelectColumn({
						cssClass : "slick-cell-checkboxsel"
					});

					var columnsSortable = [ checkboxSelector.getColumnDefinition(), {
						id : "subject",
						name : "主题",
						field : "subject",
						width : 150,
						sortable : true,
						formatter : function(row, cell, value, columnDef, dataContext) {
							return "<a href='javascript:initEditData(\"" + row + "\");'  >" + value + "</a>";
						}
					}, {
						id : "lists",
						name : "类别",
						field : "categoryId",
						formatter : listFormatter,
						width : 100,
						sortable : true
					}, {
						id : "lists",
						name : "等级",
						field : "levelId",
						width : 100,
						formatter : listFormatter,
						sortable : true
					}, {
						id : "createdDate",
						name : "创建时间",
						field : "createdDate",
						width : 150,
						formatter : dateFormatter,
						sortable : true
					}, {
						id : "displayName",
						name : "发布者",
						field : "displayName",
						width : 100,
						sortable : false
					}, {
						id : "lists",
						name : "来源",
						field : "sourceId",
						width : 100,
						formatter : listFormatter,
						sortable : true
					}, {
						id : "status",
						name : "状态",
						field : "status",
						width : 100,
						formatter : function(row, cell, value, columnDef, dataContext) {
							if (value == "1") {
								return "核实中";
							} else if (value == "2") {
								return "已核实";
							} else if (value == "3") {
								return "已转办";
							} else if (value == "10") {
								return "归档";
							} else {
								return "待核实";
							}

						},
						sortable : true
					}, {
						id : "toDoStatus",
						name : "回复状态",
						field : "toDoStatus",
						width : 100,
						formatter : function(row, cell, value, columnDef, dataContext) {
							if (value == "5") {
								return "处理中";
							} else if (value == "6") {
								return "处理完成";
							} else if (value == "7") {
								return "无法处理";
							} else {
								return "未执行";
							}
						},
						sortable : true
					}, {
						id : "#",
						name : "操作",
						field : "#",
						width : 350,
						formatter : function(row, cell, value, columnDef, dataContext) {
							var _content = [];
							var status = dataContext.status;
							var isVerify = dataContext.isVerify;
							var hasInstruction = dataContext.hasInstruction;
							var toDoStatus = dataContext.toDoStatus;
							_content.push(String.format("<a href='javascript:initInstructionOpinion({0});'>{1}</a>&nbsp;&nbsp;", row, "批示"));
							_content.push(String.format("<a href='javascript:listVerifyFollerOpinion({0});'>{1}</a>&nbsp;&nbsp;", row, "查看核实"));
							if (hasInstruction > 0) {
								_content.push(String.format("<a href='javascript:listInstructionOpinion({0});'>{1}</a>&nbsp;&nbsp;", row, "查看批示"));
							}
							
							_content.push(String.format("<a href='javascript:addTLZUsers({0});'>{1}</a>&nbsp;&nbsp;", row, "添加讨论组人员"));
							_content.push(String.format("<a href='javascript:addTLZadminUsers({0});'>{1}</a>&nbsp;&nbsp;", row, "设置统筹人"));
							

							return _content.join("");
						}
					} ];
					myGrid = new Slick.Grid("#slickGrid", myDataView, columnsSortable, options);
					myGrid.setSelectionModel(new Slick.RowSelectionModel());
					myGrid.registerPlugin(new Slick.AutoTooltips({
						enableForHeaderCells : true
					}));
					myGrid.registerPlugin(checkboxSelector);
					pager = new Slick.Controls.Pager(myDataView, myGrid, $("#pager"), {
						pagesize : 100,
						url : "${ctxPath}/mashange/listMashang"
					});
					$(".filter-submit").trigger("click");

					myDataView.onPagingInfoChanged.subscribe(function(e, pagingInfo) {
					});

					myDataView.onRowCountChanged.subscribe(function(e, args) {
						myGrid.updateRowCount();
						myGrid.render();
					});

					myDataView.onRowsChanged.subscribe(function(e, args) {
						myGrid.invalidateRows(args.rows);
						myGrid.render();
					});

					myGrid.onSort.subscribe(function(e, args) {
						var sorts = [];
						sorts.push({
							"property" : args.sortCol.field,
							"order" : args.sortAsc == true ? "asc" : "desc"
						});
						pager.setSort(sorts);
						$(".filter-submit").trigger("click");
					});

					myGrid.onScroll.subscribe(function(e, args) {
					});

					myGrid.onAddNewRow.subscribe(function(e, args) {
						var item = args.item;
						myGrid.invalidateRow(mainData.length);
						mainData.push(item);
						myGrid.updateRowCount();
						myGrid.render();
					});

					myDataView2 = new Slick.Data.DataView({
						inlineFilters : true
					});
					myDataView2.setItems([]);
					var columnsSortable2 = [ {
						id : "displayName",
						name : "参加者",
						field : "displayName",
						width : 140,
						sortable : false
					}, {
						id : "departmentName",
						name : "部门",
						field : "departmentName",
						width : 140,
						sortable : false
					}, {
						id : "createdDate",
						name : "时间",
						field : "createdDate",
						width : 150,
						formatter : dateFormatter,
						sortable : false
					}, {
						id : "memo",
						name : "内容",
						field : "memo",
						width : 250,
						sortable : false
					} ];

					myGrid2 = new Slick.Grid("#slickGrid2", myDataView2, columnsSortable2, options);
					myGrid2.setSelectionModel(new Slick.RowSelectionModel());
					myGrid2.registerPlugin(new Slick.AutoTooltips({
						enableForHeaderCells : true
					}));
					myDataView2.onPagingInfoChanged.subscribe(function(e, pagingInfo) {
					});

					myDataView2.onRowCountChanged.subscribe(function(e, args) {
						myGrid2.updateRowCount();
						myGrid2.render();
					});

					myDataView2.onRowsChanged.subscribe(function(e, args) {
						myGrid2.invalidateRows(args.rows);
						myGrid2.render();
					});

					$("#saveForm").click(function() {
						if (validationForm.valid()) {
							var jsonData = {};

							$("#validationForm .columnName").each(function() {
								if ($(this).val() != "") {
									jsonData[$(this).attr("columnName")] = $(this).val();
								}
							});

							jsonData["maShangeModel.content"] = ue.getContent();

							var _url = "${ctxPath}/mashange/save";
							$.ajax({
								url : _url,
								type : "post",
								data : jsonData,
								success : function(data) {
									if (data.success) {
										$('#large').modal('hide');
										pager.reload();
										
									} else {
										toastr.error(data.error);
									}
								}
							});

						}
					});

					$("#saveForm2").click(function() {
							if($("#mainTodo").val() == ""){
								toastr.error("必须选主办部门");
							}else{
								var mainTodo = $("#mainTodo").val();
								var subTodo = $("#subTodo").val();
								var opinionToDoModelOpinionId = $("#opinionToDoModelOpinionId").val();
								
								var params = {
										data : {
											"opinionToDoModelOpinionId" : opinionToDoModelOpinionId,
											"mainTodo" : mainTodo,
											"subTodo":subTodo.toString()
										}
									};
									var _data = {
										data : JSON.stringify(params)
									};
								
									
									$.ajax({
										url : "${ctxPath}/opinion/toDoOpinion",
										type : "post",
										data : _data,
										success : function(data) {
											$('#large').modal('hide');
											if (data.success) {
												pager.reload();
											} else {
												toastr.error(data.error);
											}
										}
									});
							}
					});
					
					
					$("#saveSelectUser").click(function() {
						var nodes2 = userTreeObj.getCheckedNodes(true);
						var selectUserNodes = [];
						for(var i = 0;i<nodes2.length;i++){
					  		 if(nodes2[i].type == 'U'){
					  			selectUserNodes.push({userId:nodes2[i].id.replace("U",""),mashangId:_id});
					  		 }
					  	 }
						if(selectUserNodes.length > 0){
							var jsonData = {users:JSON.stringify(selectUserNodes),mashangId:_id};
				              $.ajax({
					                url: "${ctxPath}/mashange/saveUsers",
					                type: "post",
					                data: jsonData,
					                success: function (data) {
					                	if(data.success){
					                		 $('#userSelect').modal('hide');
					                	}else{
					                		toastr.error(data.error);
					                	}
					                }
					              });	
						}else{
							toastr.error("请选择用户");
						}
					});
					

				});

				function initEditData(id) {
					var _data = myDataView.getItemByIdx(id);
					formInit({
						filter : "#validationForm .columnName",
						data : _data,
						modelName : "maShangeModel"
					});
					ue.setContent(_data.content);
					$('#large').modal('show');
				}
				function initVerify(id) {
					var _item = myDataView.getItemByIdx(id);
					var _items = initData["departments"];
					var inputOptions = [];
					for (var i = 0; i < _items.length; i++) {
						var j = _items[i];
						inputOptions.push({
							text : j.label,
							value : j.id
						});
					}

				}

				function listVerifyFollerOpinion(id) {
					var _data = myDataView.getItemByIdx(id);

					var params = {
						data : {
							"mashangId" : _data["id"]
						}
					};

					var _item = {
						data : JSON.stringify(params)
					};

					$.ajax({
						url : "${ctxPath}/mashange/listVerifyFollerOpinion",
						type : "post",
						data : _item,
						success : function(data) {
							if (data.success) {
								myDataView2.setItems(data.data);
								myGrid2.render();
							}
							$('#small').modal('show');
						}
					});

				}

				function listTodoFollerOpinion(id) {
					var _data = myDataView.getItemByIdx(id);

					var params = {
						data : {
							"opinionId" : _data["id"]
						}
					};

					var _item = {
						data : JSON.stringify(params)
					};

					$.ajax({
						url : "${ctxPath}/opinion/listToDoFoller",
						type : "post",
						data : _item,
						success : function(data) {
							if (data.success) {
								myDataView2.setItems(data.data);
								myGrid2.render();
							}
							$('#small').modal('show');
						}
					});

				}

				function initTodo(id) {
					var _item = myDataView.getItemByIdx(id);
					var _items = initData["departments"];
					var inputOptions = [];
					for (var i = 0; i < _items.length; i++) {
						var j = _items[i];
						inputOptions.push({
							text : j.label,
							value : j.id
						});
					}
					$("#opinionToDoModelOpinionId").val(_item["id"]);
					$("#small2").modal('show');
				}

				function initInstructionOpinion(id) {
					var _data = myDataView.getItemByIdx(id);
					var jsonData = {};

					bootbox.prompt({
						title : "批示",
						inputType : 'textarea',
						callback : function(result) {
							if ($.trim(result)) {
								jsonData["maShangeInstructionModel.memo"] = result;
								jsonData["maShangeInstructionModel.mashangId"] = _data["id"];
								var _url = "${ctxPath}/mashange/saveInstruction";
								$.ajax({
									url : _url,
									type : "post",
									data : jsonData,
									success : function(data) {
										$('#large').modal('hide');
										if (data.success) {
											pager.reload();
										} else {
											toastr.error(data.error);
										}
									}
								});
							}
						}
					});

				}

				function listInstructionOpinion(id) {
					var _data = myDataView.getItemByIdx(id);

					var params = {
						data : {
							"mashangId" : _data["id"]
						}
					};

					var _item = {
						data : JSON.stringify(params)
					};

					$.ajax({
						url : "${ctxPath}/mashange/listInstructionOpinion",
						type : "post",
						data : _item,
						success : function(data) {
							if (data.success) {
								myDataView2.setItems(data.data);
								myGrid2.render();
							}
							$('#small').modal('show');
						}
					});
				}
				
				function addTLZUsers(id){
					var _data = myDataView.getItemByIdx(id);
					_id = _data.id;
					var _userNodes = userTreeObj.getNodesByParam("type", "U", null);
					$.ajax({
						url : "${ctxPath}/mashange/get",
						type : "post",
						data : {id:_data.id},
						success : function(data) {
							if (data.success) {
								for(var i = 0;i < data.data.users.length;i++){
									var j = data.data.users[i];
									for(var a = 0,b;b = _userNodes[a++];){
										if(b.id.replace("U","") == j.userId){
											userTreeObj.checkNode(b, true, true);
										}
									}
								}
								$("#userSelect").modal('show');
							}else{
								toastr.error(data.error);
							}
							
						}
					});
					
				}
			</script>