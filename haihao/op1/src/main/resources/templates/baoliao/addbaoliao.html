<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta content="width=device-width, initial-scale=1" name="viewport" />
<meta content="" name="description" />
<meta content="" name="author" />
<!-- BEGIN GLOBAL MANDATORY STYLES -->
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=all" rel="stylesheet" type="text/css" />
<link href="${ctxPath}/static/assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
<link href="${ctxPath}/static/assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
        
<title>我要报料</title>

<link rel="stylesheet" href="${ctxPath}/static/assets/baoliao/css/course.css" type="text/css">
<link rel="stylesheet" href="${ctxPath}/static/assets/baoliao/css/main.css" type="text/css">
<link rel="stylesheet" href="${ctxPath}/static/assets/baoliao/css/base.css" type="text/css">
<style type="text/css">
	.chapter-title{
		font-weight: normal;
	}
	.txtinput{
		height: 34px;
		width: 100%;
		font-size: 12px;
		font-family: 'Microsoft YaHei';
	}
	select,textarea{
		width: 100%;
		font-size: 12px;
		font-family: 'Microsoft YaHei';
	}
	
	.course-sections li{
		padding: 0.15rem 0.5rem 0.15rem 0.6rem;
	}
	.icon-picture,.icon-docs,.icon-screen-tablet,.icon-call-end,.icon-envelope{
	  position: absolute;
	  top: 0.6rem;
	  left: 0.6rem;
	  margin-top: -2px;
	  margin-left: 0px;
	  width: 10px;
	  height: 10px;
	}
.icon-picture, .icon-docs, .icon-screen-tablet, .icon-call-end, .icon-envelope{
	top:0.8rem;
}
.help-block-error{
	color: red;
	
}
</style>

<script src="${ctxPath}/static/assets/global/plugins/jquery.min.js" type="text/javascript"></script>
<script src="${ctxPath}/static/assets/global/plugins/jquery-validation/js/jquery.validate.min.js" type="text/javascript"></script>
<script src="${ctxPath}/static/assets/global/plugins/jquery-validation/js/localization/messages_zh.js" type="text/javascript"></script>
 <!-- 配置文件 -->
<script src="${ctxPath}/static/assets/layouts/layout2/scripts/demo.js" type="text/javascript"></script>
<script src="${ctxPath}/static/assets/global/scripts/QiniuUUID.js" type="text/javascript"></script>
<script src="${ctxPath}/static/assets/global/plugins/plupload-2.1.8/js/moxie.min.js" type="text/javascript"></script>
<script src="${ctxPath}/static/assets/global/plugins/plupload-2.1.8/js/plupload.full.min.js" type="text/javascript"></script>
<script src="${ctxPath}/static/assets/global/plugins/plupload-2.1.8/js/i18n/zh_CN.js" type="text/javascript"></script>
<script src="${ctxPath}/static/assets/global/plugins/qiniu/dist/qiniu.min.js" type="text/javascript"></script>

<script src="${ctxPath}/static/assets/global/plugins/bootstrap-toastr/toastr.min.js" type="text/javascript"></script>
<link href="${ctxPath}/static/assets/global/plugins/bootstrap-toastr/toastr.min.css" rel="stylesheet" type="text/css" />
 			
<script type="text/javascript">
	window.ctxPath = "${ctxPath!}";
	window.qiniuDomain = "orbzivh5n.bkt.clouddn.com";
	window.qiniuDomainHttp = "http://" + window.qiniuDomain + "/";
</script>

</head>
<body>
<input type="hidden" id="initData" value='${initData!}'>
<script type="text/javascript">
var initData = {};
if($("#initData").val())initData = jQuery.parseJSON($("#initData").val());
</script>


	<header>
		<div class="newheader">
			<a class="imwap-arrow_l goback l" href="javscript:void(0)" onclick="javascript:history.back(-1);">
				<i class="icon-arrow-left"></i>
			</a>
			<span class="js-header-name header-name l"> 我要报料 </span> 
			<a href="mycenter" class="right-box r js-header-avator">
				<img src="http://img.mukewang.com/user/54584cc500019c5b02200220-40-40.jpg" width="40" height="40">
			</a>
			<a class="header-share r js-share" href="javascript:void(0);">
				<i class="icon-share"></i>
			</a>
		</div>
	</header>
	
	<div style="height:1.5rem"></div>

	<section class="course-content">
		<p class="course-intro">请网友客观、理性、正当地进行报料。要求实事求是，有理有据；严禁恶意中伤、打击报复、造谣诽谤、猜测夸大等报料，以及牵涉他人隐私、涉及人身攻击等违反法律法规规定、国家政策的报料和内容。报料台工作人员一经发现，有权对该报料进行处理。</p>
	</section>


	<section class="course-container">
    <div style="height:1rem"></div>
    
    <form action="#" method="post" id="baoliaoform" onsubmit="return false;">
    <ul class="course-chapter">
       <li>
        	<h3 class="chapter-title">标题</h3>
			<ul class="course-sections">
				<li>
					<input type="text" class="txtinput required" id="title" name="title" placeholder="请用一句话概括描述您的报料，限制30字符内" maxlength="30"/>
				</li>
			</ul>
		</li>
		
		 <li>
        	<h3 class="chapter-title">类别</h3>
			<ul class="course-sections">
				<li>
					<select id="type" name="type">
						
					</select>
				</li>
			</ul>
		</li>
		
		
		<li>
        	<h3 class="chapter-title">内容</h3>
			<ul class="course-sections">
				<li>
					<textarea rows="12" cols="10" id="cont" name="cont" placeholder="最多输入1000字。" maxlength="1000" class="required"></textarea>
				</li>
			</ul>
		</li>
		
		
		<li>
        	<h3 class="chapter-title">上传图片</h3>
			<ul class="course-sections">
				<li>
					<input type="hidden" class="form-control columnName" id="mainImg" name="mainImg"> 
					<input type="file" style="display: none;" id="upimgs">
					<div id="imglist"></div>
					<img alt="" src="${ctxPath}/static/assets/baoliao/images/addpic.png" id="upbtn" >
				</li>
			</ul>
		</li>
		
		
		<li>
        	<h3 class="chapter-title">验证方式</h3>
			<ul class="course-sections">
				<li style="padding-left: 1.6rem;">
					<input type="text" class="txtinput required digits number" name="telphone" id="telphone" placeholder="请输入手机号，您的手机和个人信息将受到保护" maxlength="11"/>
					<i class="icon-call-end"></i>
				</li>
				<li style="padding-left: 1.6rem;min-height: 34px;">
					
					<div style="float: left;width:70%;">
					<i class="icon-envelope"></i>
						<input type="hidden" id="code" name="code"  value=""/>
						<input type="text" class="txtinput" id="yzm" name="yzm" placeholder="请输入验证码" maxlength="8"/>
					</div>
					<div style="float: right;width: 25%;padding:0.2rem;">
						<button style="background:white;" id="personreset">获取验证码</button>
					</div>
					
					
				</li>
			</ul>
		</li>
         
         <li><a href="javascript:void(0)" class="btn-course-green">提交报料</a></li>
                  
      </ul>
      
      
      </form>
  </section>
</body>
<script type="text/javascript">

var num=60;
var settime;
function showTime(){
	var but=$("#personreset").html("重新获取"+num);
	num--;	
	if(num<0){
		num=60;		
		var but=$("#personreset").html("重新获取");
		var but=$("#code").val("");
		$('#personreset').attr("disabled",false);					
		return false;
	}
	settime=setTimeout("showTime()",1000);  		
 }
 


$(document).ready(function() {
	 //点击验证码 
	  $("#personreset").click(function(){
		var telphone=$("#telphone").val();
		if(!$("#telphone").valid()){//验证手机未通过 
			return false;
		}else{
			showTime();
			
			var params = {
					data : {
						"telphone":telphone
					}
				};
				var _data = {
					data : JSON.stringify(params)
				};
				
				$.ajax({
					url : "${ctxPath}/baoliao/ajaxsendCode",
					type : "post",
					data : _data,
					success : function(data) {
						if (data.success) {
							$("#code").val(data.data);
						}
					}
				});
			
		
			}
	 	
	  	});
	
	
	
	
	 //上传
	  var uploader = Qiniu.uploader({
      runtimes: 'html5,flash,html4',
      browse_button: 'upbtn',
      max_file_size: '10mb',
      flash_swf_url: '${ctxPath}/static/assets/global/plugins/plupload-2.1.8/js/Moxie.swf',
      chunk_size: '4mb',
      filters:[{title : "图片文件", extensions : "jpg,png,gif"}],
      uptoken_url: "${ctxPath}/ajaxGetUploadToken",
      domain: window.qiniuDomain,
      get_new_uptoken: false,
      auto_start: true,
      log_level: 5,
      init: {
          'FilesAdded': function(up, files) {
          },
         
          'UploadProgress': function(up, file) {
          },
          'UploadComplete': function() {
          	/* App.unblockUI(); */
          },
          'FileUploaded': function(up, file, info) {
          	var _key = $.parseJSON(info).key;
          	var mainimg = $("#mainImg").val();
          	
          	
          	$("#mainImg").val(_key+","+mainimg);
			
			$("#imglist").append("<div><img src='"+window.qiniuDomainHttp + _key+"' style='max-width:30%;'/><span style='position:absolute;'><i class='icon-close'></i></span></div>");
          },
          'Error': function(up, err, errTip) {
        	  
          },
          Key:function(up, file) {
          	return $.QiniuUUID().getKet(file);
          }
      }});
	 
	var baoliaoform = $("#baoliaoform");
	baoliaoform.validate({
		errorElement : 'span', //default input error message container
		errorClass : 'help-block help-block-error'
	});
	
	 //点击保存
	 $(".btn-course-green").click(function(){

		 if (baoliaoform.valid()) {
      		clearTimeout(settime);
      		$.ajax({
				url : "ajaxaddbaoliaoinfo",
				type : "post",
				data : $('#baoliaoform').serialize(),
				success : function(data) {
					if (data.success) {
						//新增成功 
						toastr.success("提交成功！");  
						setTimeout('location.href="${ctxPath}/baoliao/getschedule"', 3000);
					} else {
						toastr.error(data.error);
					}
				}
			}); 
	 	}
	});
	 
	 function selectInitList(domId,initDataId,listId){
			var _items = initData[initDataId];
			$(domId).append(String.format('<option value="{0}">{1}</option>',"","请选择..."));
			for(var i = 0;i < _items.length;i++){
				var j = _items[i];
				if(j.listId == listId){
		 			$(domId).append(String.format('<option value="{0}">{1}</option>',j["id"],j["label"]));
				}
			}
		}

		selectInitList("#type", "lists", 1);
	 
	 
	 
	 
	
});

</script>



</html>