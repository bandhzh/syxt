webpackJsonp([3],{286:function(e,t,i){i(403);var s=i(1)(i(362),i(393),"data-v-7439346a",null);e.exports=s.exports},316:function(e,t,i){"use strict";t.__esModule=!0;var s=i(15),o=(function(e){e&&e.__esModule}(s),"http://yx-web.nosdn.127.net/webdoc/h5/emoji"),n={emoji:{"[大笑]":{file:"emoji_0.png"},"[可爱]":{file:"emoji_01.png"},"[色]":{file:"emoji_02.png"},"[嘘]":{file:"emoji_03.png"},"[亲]":{file:"emoji_04.png"},"[呆]":{file:"emoji_05.png"},"[口水]":{file:"emoji_06.png"},"[汗]":{file:"emoji_145.png"},"[呲牙]":{file:"emoji_07.png"},"[鬼脸]":{file:"emoji_08.png"},"[害羞]":{file:"emoji_09.png"},"[偷笑]":{file:"emoji_10.png"},"[调皮]":{file:"emoji_11.png"},"[可怜]":{file:"emoji_12.png"},"[敲]":{file:"emoji_13.png"},"[惊讶]":{file:"emoji_14.png"},"[流感]":{file:"emoji_15.png"},"[委屈]":{file:"emoji_16.png"},"[流泪]":{file:"emoji_17.png"},"[嚎哭]":{file:"emoji_18.png"},"[惊恐]":{file:"emoji_19.png"},"[怒]":{file:"emoji_20.png"},"[酷]":{file:"emoji_21.png"},"[不说]":{file:"emoji_22.png"},"[鄙视]":{file:"emoji_23.png"},"[阿弥陀佛]":{file:"emoji_24.png"},"[奸笑]":{file:"emoji_25.png"},"[睡着]":{file:"emoji_26.png"},"[口罩]":{file:"emoji_27.png"},"[努力]":{file:"emoji_28.png"},"[抠鼻孔]":{file:"emoji_29.png"},"[疑问]":{file:"emoji_30.png"},"[怒骂]":{file:"emoji_31.png"},"[晕]":{file:"emoji_32.png"},"[呕吐]":{file:"emoji_33.png"},"[拜一拜]":{file:"emoji_160.png"},"[惊喜]":{file:"emoji_161.png"},"[流汗]":{file:"emoji_162.png"},"[卖萌]":{file:"emoji_163.png"},"[默契眨眼]":{file:"emoji_164.png"},"[烧香拜佛]":{file:"emoji_165.png"},"[晚安]":{file:"emoji_166.png"},"[强]":{file:"emoji_34.png"},"[弱]":{file:"emoji_35.png"},"[OK]":{file:"emoji_36.png"},"[拳头]":{file:"emoji_37.png"},"[胜利]":{file:"emoji_38.png"},"[鼓掌]":{file:"emoji_39.png"},"[握手]":{file:"emoji_200.png"},"[发怒]":{file:"emoji_40.png"},"[骷髅]":{file:"emoji_41.png"},"[便便]":{file:"emoji_42.png"},"[火]":{file:"emoji_43.png"},"[溜]":{file:"emoji_44.png"},"[爱心]":{file:"emoji_45.png"},"[心碎]":{file:"emoji_46.png"},"[钟情]":{file:"emoji_47.png"},"[唇]":{file:"emoji_48.png"},"[戒指]":{file:"emoji_49.png"},"[钻石]":{file:"emoji_50.png"},"[太阳]":{file:"emoji_51.png"},"[有时晴]":{file:"emoji_52.png"},"[多云]":{file:"emoji_53.png"},"[雷]":{file:"emoji_54.png"},"[雨]":{file:"emoji_55.png"},"[雪花]":{file:"emoji_56.png"},"[爱人]":{file:"emoji_57.png"},"[帽子]":{file:"emoji_58.png"},"[皇冠]":{file:"emoji_59.png"},"[篮球]":{file:"emoji_60.png"},"[足球]":{file:"emoji_61.png"},"[垒球]":{file:"emoji_62.png"},"[网球]":{file:"emoji_63.png"},"[台球]":{file:"emoji_64.png"},"[咖啡]":{file:"emoji_65.png"},"[啤酒]":{file:"emoji_66.png"},"[干杯]":{file:"emoji_67.png"},"[柠檬汁]":{file:"emoji_68.png"},"[餐具]":{file:"emoji_69.png"},"[汉堡]":{file:"emoji_70.png"},"[鸡腿]":{file:"emoji_71.png"},"[面条]":{file:"emoji_72.png"},"[冰淇淋]":{file:"emoji_73.png"},"[沙冰]":{file:"emoji_74.png"},"[生日蛋糕]":{file:"emoji_75.png"},"[蛋糕]":{file:"emoji_76.png"},"[糖果]":{file:"emoji_77.png"},"[葡萄]":{file:"emoji_78.png"},"[西瓜]":{file:"emoji_79.png"},"[光碟]":{file:"emoji_80.png"},"[手机]":{file:"emoji_81.png"},"[电话]":{file:"emoji_82.png"},"[电视]":{file:"emoji_83.png"},"[声音开启]":{file:"emoji_84.png"},"[声音关闭]":{file:"emoji_85.png"},"[铃铛]":{file:"emoji_86.png"},"[锁头]":{file:"emoji_87.png"},"[放大镜]":{file:"emoji_88.png"},"[灯泡]":{file:"emoji_89.png"},"[锤头]":{file:"emoji_90.png"},"[烟]":{file:"emoji_91.png"},"[炸弹]":{file:"emoji_92.png"},"[枪]":{file:"emoji_93.png"},"[刀]":{file:"emoji_94.png"},"[药]":{file:"emoji_95.png"},"[打针]":{file:"emoji_96.png"},"[钱袋]":{file:"emoji_97.png"},"[钞票]":{file:"emoji_98.png"},"[银行卡]":{file:"emoji_99.png"},"[手柄]":{file:"emoji_100.png"},"[麻将]":{file:"emoji_101.png"},"[调色板]":{file:"emoji_102.png"},"[电影]":{file:"emoji_103.png"},"[麦克风]":{file:"emoji_104.png"},"[耳机]":{file:"emoji_105.png"},"[音乐]":{file:"emoji_106.png"},"[吉他]":{file:"emoji_107.png"},"[火箭]":{file:"emoji_108.png"},"[飞机]":{file:"emoji_109.png"},"[火车]":{file:"emoji_110.png"},"[公交]":{file:"emoji_111.png"},"[轿车]":{file:"emoji_112.png"},"[出租车]":{file:"emoji_113.png"},"[警车]":{file:"emoji_114.png"},"[自行车]":{file:"emoji_115.png"}}};for(var a in n){var r=n[a];for(var l in r){var f=r[l];f.img=o+"/"+a+"/"+f.file}}for(var m={ajmd:{},xxy:{},lt:{}},g=1;g<=48;g++){var p="ajmd0"+(g>=10?g:"0"+g);m.ajmd[p]={file:p+".png"}}for(var c=1;c<=40;c++){var u="xxy0"+(c>=10?c:"0"+c);m.xxy[u]={file:u+".png"}}for(var d=1;d<=20;d++){var _="lt0"+(d>=10?d:"0"+d);m.lt[_]={file:_+".png"}}for(var h in m){var j=m[h];for(var v in j){var y=j[v];y.img=o+"/"+h+"/"+y.file}}t.default={emojiList:n,pinupList:m},e.exports=t.default},317:function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var o=i(16),n=s(o),a=i(41),r=s(a),l=i(15),f=s(l),m=i(316),g=s(m);t.default={props:{type:String,rawMsg:{type:Object,default:function(){return{}}},userInfos:{type:Object,default:function(){return{}}},myInfo:{type:Object,default:function(){return{}}},isRobot:{type:Boolean,default:function(){return!1}},robotInfos:{type:Object,default:function(){return{}}}},data:function(){return{msg:"",isFullImgShow:!1,currentAudio:null}},computed:{robotInfos:function(){return this.$store.state.robotInfos}},beforeMount:function(){var e=(0,n.default)({},this.rawMsg);if("session"===this.type)if("in"===e.flow)if("robot"===e.type&&e.content&&e.content.msgOut){var t=e.content.robotAccid;e.avatar=this.robotInfos[t].avatar,e.isRobot=!0,e.link="#/namecard/"+t}else e.from!==this.$store.state.userUID?(e.avatar=this.userInfos[e.from]&&this.userInfos[e.from].avatar||f.default.defaultUserIcon,e.link="#/namecard/"+e.from):e.avatar=this.myInfo.avatar;else"out"===e.flow&&(e.avatar=this.myInfo.avatar);else e.showTime=r.default.formatDate(e.time);if("timeTag"===e.type)e.showText=e.text;else if("text"===e.type){if(e.showText=r.default.escape(e.text),/\[[^\]]+\]/.test(e.showText)){var i=e.showText.match(/\[[^\]]+\]/g);i.forEach(function(t){var i=g.default.emojiList.emoji;i[t]&&(e.showText=e.showText.replace(t,'<img class="emoji-small" src="'+i[t].img+'">'))})}}else if("custom"===e.type){var s=JSON.parse(e.content);if(1===s.type){var o=s.data,a=f.default.resourceUrl;e.type="custom-type1",e.imgUrl=a+"/im/play-"+o.value+".png"}else if(3===s.type){var l=s.data,m="";g.default.pinupList[l.catalog]&&(m=g.default.pinupList[l.catalog][l.chartlet],e.type="custom-type3",e.imgUrl=""+m.img)}else e.showText=r.default.parseCustomMsg(e),"[自定义消息]"!==e.showText&&(e.showText+=",请到手机或电脑客户端查看")}else if("image"===e.type)e.originLink=e.file.url;else if("video"===e.type);else if("audio"===e.type)e.audioSrc=e.file.mp3Url,e.showText=Math.round(e.file.dur/1e3)+'" 点击播放';else if("file"===e.type)e.fileLink=e.file.url,e.showText=e.file.name;else if("notification"===e.type)e.showText=r.default.generateChatroomSysMsg(e);else if("tip"===e.type)e.showText=e.tip;else if("robot"===e.type){var p=e.content||{},c=p.message||[];if(p.msgOut){if("bot"===p.flag)e.subType="bot",c=c.map(function(e){return"template"===e.type?e.content.json:"text"===e.type||"answer"===e.type?[{type:"text",text:e.content}]:"image"===e.type?[{type:"image",url:e.content}]:void 0}),e.message=c;else if("faq"===e.content.flag){e.subType="faq",e.query=c.query;var u=c.match.sort(function(e,t){return t.score-e.score});e.message=u[0]}}else e.robotFlow="out",e.showText=e.text}else e.showText="["+r.default.mapMsgType(e)+"],请到手机或电脑客户端查看";this.msg=e},mounted:function(){var e=this,t=this.msg;this.$nextTick(function(){var i=null;if("image"===t.type)i=new Image,i.src=t.file.url+"?imageView&thumbnail=180x0&quality=85";else if("custom-type1"===t.type)i=new Image,i.className="emoji-middle",i.src=t.imgUrl;else if("custom-type3"===t.type)i=new Image,i.className="emoji-big",i.src=t.imgUrl;else if("video"===t.type)if(/(mov|mp4|ogg|webm)/i.test(t.file.ext))i=document.createElement("video"),i.src=t.file.url,i.width=640,i.height=480,i.autoStart=!1,i.preload="metadata",i.controls="controls";else{var s=document.createElement("a");s.href=t.file.url,s.target="_blank",s.innerHTML='<i class="u-icon icon-file"></i>'+video.name,e.$refs.mediaMsg.appendChild(s)}i?(e.$refs.mediaMsg&&e.$refs.mediaMsg.appendChild(i),i.onload=function(){e.$emit("msg-loaded")},i.onerror=function(){e.$emit("msg-loaded")}):e.$emit("msg-loaded")})},methods:{revocateMsg:function(e){if(this.$store.state.currSessionId&&e&&e.data&&e.data.attrs){var t=e.data.attrs;if("robot"===t.type)return;if("out"===t.flow){var i=this;this.$vux.confirm.show({title:"确定需要撤回消息",onCancel:function(){},onConfirm:function(){i.$store.dispatch("revocateMsg",{idClient:t.idClient})}})}}},sendRobotBlockMsg:function(e,t){var i="[复杂按钮模板触发消息]";e.text&&1===e.text.length&&(i=e.text[0].text);var s=t.content.robotAccid;this.isRobot||(i="@"+this.robotInfos[s].nick+" "+i),this.$store.dispatch("sendRobotMsg",{type:"link",scene:t.scene,to:t.to,robotAccid:s,params:e.params,target:e.target,body:i})},continueRobotMsg:function(e){this.$store.dispatch("continueRobotMsg",e)},showFullImg:function(e){this.$store.dispatch("showFullscreenImg",{src:e})},playAudio:function(e){var t=this;this.currentAudio||(this.currentAudio=new Audio(e),this.currentAudio.play(),this.currentAudio.onended=function(){t.currentAudio=null})}}},e.exports=t.default},318:function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var o=i(41),n=(s(o),i(15)),a=(s(n),i(316)),r=(s(a),i(325)),l=s(r);t.default={components:{ChatItem:l.default},props:{type:String,canLoadMore:[String,Boolean],isRobot:{type:Boolean,default:function(){return!1}},msglist:{type:Array,default:function(){return[]}},userInfos:{type:Object,default:function(){return{}}},myInfo:{type:Object,default:function(){return{}}},robotInfos:{type:Object,default:function(){return{}}}},data:function(){return{isFullImgShow:!1,msgLoadedTimer:null}},methods:{showFullImg:function(e){this.$store.dispatch("showFullscreenImg",{src:e})},msgLoaded:function(){var e=this;clearTimeout(this.msgLoadedTimer),this.msgLoadedTimer=setTimeout(function(){e.$emit("msgs-loaded")},20)}}},e.exports=t.default},319:function(e,t,i){t=e.exports=i(4)(void 0),t.push([e.i,".p-chat-list .u-icon{width:1.4rem;height:1.6rem;margin-right:.2rem;vertical-align:bottom}",""])},320:function(e,t,i){t=e.exports=i(4)(void 0),t.push([e.i,".p-chat-history .u-msg .msg-link[data-v-236c641c]{display:none}",""])},321:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ul",{staticClass:"m-chat-list p-chat-list",attrs:{id:"chat-list"}},[e.canLoadMore?i("li",{staticClass:"u-msg item-time"},[e._v("\n    ---- 上拉加载更多 ----\n  ")]):i("li",{staticClass:"u-msg item-time"},[e._v("\n    ---- 已无更多记录 ----\n  ")]),e._v(" "),e._l(e.msglist,function(t){return i("chat-item",{key:t.idClient,attrs:{type:e.type,rawMsg:t,isRobot:e.isRobot,userInfos:e.userInfos,robotInfos:e.robotInfos,myInfo:e.myInfo},on:{"msg-loaded":e.msgLoaded}})})],2)},staticRenderFns:[]}},322:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("li",{staticClass:"u-msg",class:{"item-me":"out"===e.msg.flow,"item-you":"in"===e.msg.flow,"item-time":"timeTag"===e.msg.type,"item-tip":"tip"===e.msg.type,"session-chat":"session"===e.type}},["timeTag"===e.msg.type?i("div",[e._v("---- "+e._s(e.msg.showText)+" ----")]):"tip"===e.msg.type?i("div",{staticClass:"tip"},[e._v(e._s(e.msg.showText))]):"in"===e.msg.flow||"out"===e.msg.flow?i("div",{directives:[{name:"touch",rawName:"v-touch:hold",value:e.revocateMsg,expression:"revocateMsg",arg:"hold"}],attrs:{idClient:e.msg.idClient,time:e.msg.time,flow:e.msg.flow,type:e.msg.type}},[e.msg.avatar?i("a",{staticClass:"msg-head",attrs:{href:e.msg.link}},[i("img",{attrs:{src:e.msg.avatar}})]):"notification"!==e.msg.type?i("p",{staticClass:"msg-user"},[i("em",[e._v(e._s(e.msg.showTime))]),e._v(e._s(e.msg.from))]):e._e(),e._v(" "),"text"===e.msg.type?i("span",{staticClass:"msg-text",domProps:{innerHTML:e._s(e.msg.showText)}}):"custom-type1"===e.msg.type?i("span",{ref:"mediaMsg",staticClass:"msg-text"}):"custom-type3"===e.msg.type?i("span",{ref:"mediaMsg",staticClass:"msg-text"}):"image"===e.msg.type?i("span",{ref:"mediaMsg",staticClass:"msg-text",on:{click:function(t){t.stopPropagation(),e.showFullImg(e.msg.originLink)}}}):"video"===e.msg.type?i("span",{ref:"mediaMsg",staticClass:"msg-text"}):"audio"===e.msg.type?i("span",{staticClass:"msg-text",on:{click:function(t){e.playAudio(e.msg.audioSrc)}}},[e._v(e._s(e.msg.showText))]):"file"===e.msg.type?i("span",{staticClass:"msg-text"},[i("a",{attrs:{href:e.msg.fileLink,target:"_blank"}},[i("i",{staticClass:"u-icon icon-file"}),e._v(e._s(e.msg.showText))])]):"robot"===e.msg.type?i("span",{staticClass:"msg-text",class:{"msg-robot":"out"!==e.msg.robotFlow&&!e.isRobot}},["out"===e.msg.robotFlow?i("div",[e._v(e._s(e.msg.showText))]):"bot"===e.msg.subType?i("div",e._l(e.msg.message,function(t){return i("div",e._l(t,function(t){return i("div",["text"===t.type?i("div",[i("p",[e._v(e._s(t.text))])]):"image"===t.type?i("div",[i("p",[i("img",{attrs:{src:t.url}})])]):"url"===t.type?i("div",[i("a",{class:t.style,attrs:{href:t.target,target:"_blank"}},[t.image?i("div",e._l(t.image,function(e){return i("p",[i("img",{attrs:{src:e.url}})])})):e._e(),e._v(" "),t.text?i("div",e._l(t.text,function(t){return i("p",[e._v(e._s(t.text))])})):e._e()])]):"block"===t.type?i("div",[i("a",{class:t.style,attrs:{params:t.params,target:t.target},on:{click:function(i){e.sendRobotBlockMsg(t,e.msg)}}},[t.image?i("div",e._l(t.image,function(e){return i("p",[i("img",{attrs:{src:e.url}})])})):e._e(),e._v(" "),t.text?i("div",e._l(t.text,function(t){return i("p",[e._v(e._s(t.text))])})):e._e()])]):e._e()])}))})):"faq"===e.msg.subType?i("div",[i("p",[e._v(e._s(e.msg.message.answer))])]):e._e(),e._v(" "),"out"===e.msg.robotFlow||e.isRobot?e._e():i("span",{staticClass:"msg-link"},[i("a",{staticClass:"link-right",on:{click:function(t){e.continueRobotMsg(e.msg.content.robotAccid)}}},[e._v("继续对话")])])]):"notification"===e.msg.type?i("span",{staticClass:"msg-text notify"},[e._v(e._s(e.msg.showText))]):i("span",{staticClass:"msg-text",domProps:{innerHTML:e._s(e.msg.showText)}}),e._v(" "),"fail"===e.msg.status?i("span",{staticClass:"msg-failed"},[i("i",{staticClass:"weui-icon-warn"})]):e._e()]):e._e()])},staticRenderFns:[]}},323:function(e,t,i){var s=i(319);"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);i(5)("6e57deea",s,!0)},324:function(e,t,i){var s=i(320);"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);i(5)("eecc2c64",s,!0)},325:function(e,t,i){i(324);var s=i(1)(i(317),i(322),"data-v-236c641c",null);e.exports=s.exports},326:function(e,t,i){i(323);var s=i(1)(i(318),i(321),null,null);e.exports=s.exports},362:function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var o=i(326),n=s(o),a=i(41),r=s(a),l=i(62),f=s(l);t.default={beforeMount:function(){this.$store.state.isRefresh&&(location.href="#/chat/"+this.sessionId)},mounted:function(){this.$store.dispatch("resetNoMoreHistoryMsgs"),this.getHistoryMsgs()},updated:function(){var e=f.default.getChatListHeight();f.default.scrollChatListDown(e-this.currPagePos),this.currPagePos=e},components:{ChatList:n.default},data:function(){return{leftBtnOptions:{backText:" ",preventGoBack:!0},currPagePos:0}},computed:{sessionId:function(){return this.$route.params.sessionId},sessionName:function(){var e=this.sessionId,t=null;if(/^p2p-/.test(e)){if((t=e.replace(/^p2p-/,""))===this.$store.state.userUID)return"我的手机";if(this.isRobot)return this.robotInfos[t].nick||t;var i=this.userInfos[t]||{};return r.default.getFriendAlias(i)}if(/^team-/.test(e))return"群"},isRobot:function(){var e=this.sessionId,t=null;return!(!/^p2p-/.test(e)||(t=e.replace(/^p2p-/,""),!this.robotInfos[t]))},myInfo:function(){return this.$store.state.myInfo},userInfos:function(){return this.$store.state.userInfos},msglist:function(){return this.$store.state.currSessionMsgs},robotInfos:function(){return this.$store.state.robotInfos},scene:function(){return r.default.parseSession(this.sessionId).scene},to:function(){return r.default.parseSession(this.sessionId).to},canLoadMore:function(){return!this.$store.state.noMoreHistoryMsgs}},methods:{getHistoryMsgs:function(){this.canLoadMore&&this.$store.dispatch("getHistoryMsgs",{scene:this.scene,to:this.to})},loadMore:function(){f.default.getChatListScroll()<=5&&this.getHistoryMsgs()},onClickBack:function(){window.history.go(-1)}}},e.exports=t.default},380:function(e,t,i){t=e.exports=i(4)(void 0),t.push([e.i,".p-chat-history .m-chat-main[data-v-7439346a]{padding:0}",""])},393:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"g-inherit m-article p-chat-history"},[i("x-header",{staticClass:"m-tab",attrs:{"left-options":e.leftBtnOptions},on:{"on-click-back":e.onClickBack}},[i("h1",{staticClass:"m-tab-top"},[e._v(e._s(e.sessionName))]),e._v(" "),i("a",{slot:"left"})]),e._v(" "),i("div",{staticClass:"m-chat-main"},[i("chat-list",{directives:[{name:"touch",rawName:"v-touch:swipedown",value:e.loadMore,expression:"loadMore",arg:"swipedown"}],ref:"chatlist",attrs:{type:"session",canLoadMore:e.canLoadMore,msglist:e.msglist,userInfos:e.userInfos,myInfo:e.myInfo,robotInfos:e.robotInfos}})],1)],1)},staticRenderFns:[]}},403:function(e,t,i){var s=i(380);"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);i(5)("32f81c70",s,!0)}});